sudo: false
os: linux
language: haskell
addons:
  apt:
    packages:
    - texlive-latex-recommended lmodern texlive-fonts-recommended texlive-latex-extra
      texlive-fonts-extra dvipng texlive-latex-recommended texlive-lang-french
before_install:
- sudo add-apt-repository -y ppa:jonathonf/python-2.7
- sudo apt-get update
- sudo apt-get install python2.7  librsvg2-bin
install:
- wget https://github.com/jgm/pandoc/releases/download/2.0.6/pandoc-2.0.6-1-amd64.deb
- sudo dpkg -i pandoc-2.0.6-1-amd64.deb
- wget https://github.com/lierdakil/pandoc-crossref/releases/download/v0.3.0.1/linux-ghc80-pandoc20.tar.gz
- mkdir pandoc-crossref
- cd pandoc-crossref
- mv ../linux-ghc80-pandoc20.tar.gz .
- tar xzvf linux-ghc80-pandoc20.tar.gz
- cd ..
- export PATH=`pwd`/pandoc-crossref:$PATH
- sudo -H pip install --upgrade pip
- sudo -H pip install -U pandoc-numbering
cache:
- pip
script:
- make
after_deploy: |
  git config --global user.email "travis@travis-ci.org"
  git config --global user.name "Travis CI"
  cd "$TRAVIS_BUILD_DIR"
  git clone https://${GH_TOKEN}@github.com/mathintro/mathintro.github.io.git
  cd mathintro.github.io
  # This generates a `web` directory containing the website.
  cp ../cours.html deuxieme_logiciel/index.html
  git add deuxieme_logiciel/index.html
  git commit --message "Travis build: $TRAVIS_BUILD_NUMBER"
  # Make sure to make the output quiet, or else the API token will leak!
  # This works because the API key can replace your password.
  git push --quiet https://${GH_TOKEN}@github.com/mathintro/mathintro.github.io.git
env:
  global:
  - secure: JfpN39ndxI/SpO9moA/ecutZNnES04RLIM4lL1uIJ6JevXB5fLgW0tUNrmi5bxO0jBtXTf65l3r0GzD6mfcUmF3xm50cWP7Haq55yNi86sVRO5m88RsN1qrxgN6YheYWAvt6arHjoglCzTIn2/U44i8fTnus7LeaX72Nry8xA8SSh7kU4ccdkmBz8NpfS2H+/JEdGtJOX5Yd3OqrHqkU+nXur1x+R9csYsj3kNRTPfd+A3GzVynm+6UihecFC/phvlpbt5lTQZf0PYuUksb5sehoSY46isKyE1tIILDWdlaVIZT2RuS3Nylk6NGdZDwp5BdVNzCNjriSv+B5VQWvo451KSUpN1QEopYq5QLdEG/1qK0Vd3fV5xFhWh2Y5iA2/aEDigoWyKigZF0vgE0sfDlAd5VNv9EsD824jU2pECwUVEW2hRWzLC9cjhhO+vzRsYhVpFBGVgZN5p4iL10uYRdEjrPKya4VTeuXUYnG0K83t44QeV6K9h96VgKvLhrrUo+KTF8y6O8lksO0llpD/kgNg+HLqoK02MmY36LcHxKdJQVdhVC9tK7Z7QuER+/HX6WNnu5yfflfmnsbJuW0wP0xMO2UKBGW1a5+9tVKwaui4Zv1L+wugMEGFnnphcKQ8dbmh+1NNKwVU5bWfyUfxj7F8teD18ciDxIYXTsueQY=
deploy:
  provider: releases
  api_key:
    secure: ibGOTcj47iyMMxK7VR1+Q3R4ilNiYtUTjew3dZQTAhiDmgp0TKUP+5A2oBGveAWmZgbxTpQZGnKqUFoJjiWF0WB+O8aaC1gmNgnYdIpQNFA900B+sPoTKSPTIiF4PqyS/+PW1dMzcbZR2r57AW7VWC/0w21CFFP+Q8CyLf13WfC2VeafxWYQir2gybbE6xphP7UVdcRnLeyqXWi6x06PV8jP5exE3UAAZRfrnkVCWik/dqskxt4EWUSRoDC/aIUkT04wT+n7H6WqOhhLV9VPZsx7NREIQwH9iFREJVablM2+Je7OjOmhiNX726eO7ihEIPN9TNia+u0gwJqV0MVPVDfws87WW+MzQ5MsS21m6Ox3g09s3yQvPcfxw7pV/+te8+DO9fXy1GaExDJPbxN7hTthB6BEXTI/y3wHmdvsonIz2rCEq9NGfwjQ/DgkHFb3VpHlXwhVyx/9nD3UkaTXaqu5Lg9hpbv7DbJhOUB5RddOXbRFTi+I7r7uAZuQfgkkitNpRwj6Shx0vzmVuQwbmff8XuC8StsGmbTYbtDjbO/4y2TXe+CvtxIEq5ZAGkvNlq3SRO7eTIcTC0Pe47cfstCixgzM81lbpmAN03Ufxb8hgzoo42z7ocQMHijL/QiYX5OrEXjJ8bNbOfNV8kfwd3icHEQtyOZAXowABsM8tmU=
  file:
  - cours.html
  - cours.pdf
  skip_cleanup: true
  on:
    repo: mathintro/deuxieme_logiciel
    tags: true
